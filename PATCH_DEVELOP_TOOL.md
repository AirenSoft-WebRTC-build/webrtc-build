# [WIP] パッチ開発支援ツールについて

本文書では、本リポジトリ用に用意したパッチ開発支援ツール `patchdev.py` について説明します。 `patchdev.py` は `scripts/patchdev.py` にあります。


## 目的

本ツールの主な目的は次の 2 つです。

- 開発中のパッチに関するソースコードを Git で管理できるようにする
- パッチファイルの作成など、パッチ開発で多用する操作を簡略にする


## 機能

本ツールは以下の機能を提供します。

- 開発中のソースコードを libwebrtc のリポジトリ外で編集・管理できるようにする
- 開発中のソースコードを libwebrtc に組み込んでビルドする
- パッチファイルを作成する


## [WIP] パッチ開発の流れ



## サブコマンド

以下は `patchdev.py` の各サブコマンドの詳細な説明です。 `init` 以外は、プロジェクトごとに生成される `Makefile` で実行できます。

### `init`

トップレベルの `patchdev` 以下に新しいプロジェクトを作成します。以下のファイルを生成します:

- `Makefile`: `patchdev.py` のサブコマンドを実行するターゲットを定義してあります。
- `config.json`: パッチに関する設定ファイルです。
- `src/`: このディレクトリにソースコードを配置します。設定ファイルでソースコードを指定して `make sync`を実行すると、オリジナルのファイルがこのディレクトリにコピーされます。


### `sync`

設定ファイルで指定したファイルを`src` にコピーします。ただし、既に `src` に存在するファイルはコピーされません。


### `build`

`src` のソースコードを libwebrtc のソースコードがあるディレクトリにコピーし、 `run.py` を使用してビルドします。設定ファイルで指定されたプラットフォームが対象になります。

`run.py` に渡すコマンドラインオプションを指定するには、渡したいオプションを設定ファイルで `build_flags` に指定します。


### `check`

`src` のファイル終端の改行の有無をチェックします。改行が存在しなければエラーになります。


### `diff`

`src` のソースコードとオリジナルのソースコードとの差分を表示します。ファイル終端の改行の有無もチェックします。


### `patch`

パッチファイルを作成します。すべての差分を 1 つのファイルにまとめます。事前にファイル終端の改行の有無をチェックします。

パッチファイルは `_build` 以下に生成されます。ファイル名は設定ファイルの `output` で指定します。

パッチ開発が終わったら、パッチファイルをトップレベルの `patches` ディレクトリにコピーしてください。


### `clean`

`build` コマンドでオリジナルに加えたすべての変更を元に戻し、 `_build` を削除します。 `src` のファイルに影響はありません。
