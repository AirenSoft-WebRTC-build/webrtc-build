diff --git a/modules/video_coding/BUILD.gn b/modules/video_coding/BUILD.gn
index acec4570a3..5a8080c6ee 100644
--- a/modules/video_coding/BUILD.gn
+++ b/modules/video_coding/BUILD.gn
@@ -472,15 +472,46 @@ rtc_library("webrtc_h264") {
   visibility = [ "*" ]
   sources = [
     "codecs/h264/h264.cc",
-    "codecs/h264/h264_color_space.cc",
-    "codecs/h264/h264_color_space.h",
-    "codecs/h264/h264_decoder_impl.cc",
-    "codecs/h264/h264_decoder_impl.h",
-    "codecs/h264/h264_encoder_impl.cc",
-    "codecs/h264/h264_encoder_impl.h",
     "codecs/h264/include/h264.h",
   ]
 
+  if (rtc_use_h264) {
+    sources += [
+      "codecs/h264/h264_color_space.cc",
+      "codecs/h264/h264_color_space.h",
+      "codecs/h264/h264_decoder_impl.cc",
+      "codecs/h264/h264_decoder_impl.h",
+      "codecs/h264/h264_encoder_impl.cc",
+      "codecs/h264/h264_encoder_impl.h",
+    ]
+  }
+
+  if (rtc_win_use_mf_h264) {
+    sources += [
+      "codecs/h264/winuwp/h264_mf_factory.cc",
+      "codecs/h264/winuwp/h264_mf_factory.h",
+      "codecs/h264/winuwp/utils/async.h",
+      "codecs/h264/winuwp/utils/crit_sec.h",
+      "codecs/h264/winuwp/utils/utils.h",
+      "codecs/h264/winuwp/utils/sample_attribute_queue.h",
+      "codecs/h264/winuwp/decoder/h264_decoder_mf_impl.cc",
+      "codecs/h264/winuwp/decoder/h264_decoder_mf_impl.h",
+      "codecs/h264/winuwp/encoder/h264_encoder_mf_impl.cc",
+      "codecs/h264/winuwp/encoder/h264_encoder_mf_impl.h",
+      "codecs/h264/winuwp/encoder/h264_media_sink.cc",
+      "codecs/h264/winuwp/encoder/h264_media_sink.h",
+      "codecs/h264/winuwp/encoder/h264_stream_sink.cc",
+      "codecs/h264/winuwp/encoder/h264_stream_sink.h",
+      "codecs/h264/winuwp/encoder/ih264_encoding_callback.h",
+    ]
+
+    libs = [
+      "mfreadwrite.lib",
+      "mfplat.lib",
+      "mfuuid.lib",
+    ]
+  }
+ 
   defines = []
   deps = [
     ":video_codec_interface",
diff --git a/webrtc.gni b/webrtc.gni
index 71cfcabd02..421fd64344 100644
--- a/webrtc.gni
+++ b/webrtc.gni
@@ -236,6 +236,10 @@ declare_args() {
   #        Windows 10. It is ok to use this option with any API family
   #        (desktop (Win32), app (Store), ...).
   rtc_win_video_capture_winrt = false
+  
+  # When is set to true, a H264 encoder using Windows Media Foundation
+  # will be included in the libwebrtc.lib
+  rtc_win_use_mf_h264 = false
 }
 
 if (!build_with_mozilla) {
